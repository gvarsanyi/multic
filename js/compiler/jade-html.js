// Generated by CoffeeScript 1.9.1
var compiler, error_parser;

compiler = require('jade');

error_parser = require('../error-parser');

module.exports = function(inf, cb) {
  var desc, err, err_line, i, includes, len, line, line_n, ref, ref1;
  try {
    inf.res.compiled = compiler.render(inf.source, {
      filename: inf.file,
      compileDebug: false,
      pretty: true,
      includes: (includes = [])
    });
    if (Array.isArray(includes)) {
      (ref = inf.res.includes).push.apply(ref, includes);
    }
  } catch (_error) {
    err = _error;
    desc = String(err).split('\n\n').slice(1).join('\n\n');
    ref1 = String(err).split('\n');
    for (i = 0, len = ref1.length; i < len; i++) {
      err_line = ref1[i];
      if (err_line.substr(0, 4) === '  > ' && (line_n = String(err_line.substr(4).split('|')[0]).trim()) && !isNaN(line_n = Number(line_n))) {
        line = line_n - 1;
        break;
      }
    }
    inf.res.errors.push(error_parser(inf, err, line, desc));
  }
  return cb();
};
